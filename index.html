<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>RHCSA V10 Lab - Exame Oficial</title>
    <style>
        body { margin: 0; display: flex; height: 100vh; background: #1e1e1e; font-family: 'Segoe UI', sans-serif; color: white; }
        #sidebar { width: 350px; background: #2d2d2d; border-right: 2px solid #444; overflow-y: auto; padding: 10px; }
        #instructions { width: 400px; padding: 20px; background: #252525; border-right: 2px solid #444; overflow-y: auto; }
        #terminal-container { flex-grow: 1; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }
        .task-item { padding: 12px; margin-bottom: 5px; background: #3d3d3d; cursor: pointer; border-radius: 4px; font-size: 14px; border-left: 3px solid transparent; }
        .task-item.node1 { border-left-color: #3498db; }
        .task-item.node2 { border-left-color: #e74c3c; }
        .task-item:hover { background: #505050; }
        .btn-check { background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 20px; }
        .btn-check:hover { background: #27ae60; }
        .btn-hint { background: #f39c12; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
        .btn-hint:hover { background: #e67e22; }
        #status { margin-top: 15px; padding: 15px; border-radius: 5px; display: none; font-size: 14px; line-height: 1.5; }
        h2 { color: #e74c3c; font-size: 18px; border-bottom: 1px solid #444; padding-bottom: 10px; margin-top: 0; }
        h3 { color: #3498db; margin-bottom: 10px; }
        code { background: #000; color: #00ff00; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
        pre { background: #1e1e1e; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .node-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .node1-badge { background: #3498db; color: white; }
        .node2-badge { background: #e74c3c; color: white; }
        .progress-container { margin-top: 20px; }
        .progress-bar { height: 10px; background: #444; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: #2ecc71; width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>üìã RHCSA V10 - EX200</h2>
    <div style="margin-bottom: 15px; padding: 10px; background: #333; border-radius: 5px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>Progresso:</span>
            <span id="progress-text">0/20</span>
        </div>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
        </div>
    </div>
    <div id="task-list"></div>
</div>

<div id="instructions">
    <h3 id="task-title">Selecione uma tarefa</h3>
    <div id="task-desc" style="margin-bottom: 20px; background: #333; padding: 15px; border-radius: 5px;">
        Escolha um dos laborat√≥rios √† esquerda para come√ßar seus estudos para a certifica√ß√£o EX200.
    </div>
    
    <div id="task-details" style="display: none;">
        <div style="background: #2c3e50; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
            <strong>Node:</strong> <span id="task-node"></span>
        </div>
    </div>
    
    <button id="btn-verify" class="btn-check" style="display:none;" onclick="verifyTask()">‚úÖ Verificar Resposta</button>
    <button id="btn-hint" class="btn-hint" style="display:none;" onclick="getAiHint()">üí° Dica da IA</button>
    <div id="status"></div>
</div>

<div id="terminal-container">
    <iframe src="http://localhost:7681"></iframe>
</div>

<script>
    let currentTaskId = null;
    let completedTasks = new Set(JSON.parse(localStorage.getItem('completedTasks') || '[]'));
    
    const tasks = {
        // Node 1 (1-13)
        1: { t: "01. Rede e Hostname", n: 1, d: "Configure a rede e o hostname:<br><br>IP Address: <code>10.129.203.120/24</code><br>Gateway: <code>10.129.203.112</code><br>DNS: <code>10.129.203.112</code><br>Domain: <code>lab.example.com</code><br>Hostname: <code>node1.lab.example.com</code>" },
        2: { t: "02. Reposit√≥rios DNF", n: 1, d: "Configure os reposit√≥rios em <code>/etc/yum.repos.d/exam.repo</code>:<br><br><pre>[BaseOS]\nname=BaseOS\nbaseurl=file:///mnt/BaseOS\ngpgcheck=0\nenabled=1\n\n[AppStream]\nname=AppStream\nbaseurl=file:///mnt/AppStream\ngpgcheck=0\nenabled=1</pre>" },
        3: { t: "03. SELinux e Apache", n: 1, d: "Corrija o SELinux para que o Apache:<br><br>A) Sirva arquivos de <code>/var/www/html</code><br>B) Execute na porta <code>82</code><br>C) Seja acess√≠vel via <code>http://10.129.203.120:82</code>" },
        4: { t: "04. Usu√°rios e Grupos", n: 1, d: "Crie:<br><br>‚Ä¢ Grupo <code>sysmgrs</code><br>‚Ä¢ Usu√°rio <code>john</code> (membro de sysmgrs)<br>‚Ä¢ Usu√°ria <code>emma</code> (membro de sysmgrs)<br>‚Ä¢ Usu√°rio <code>michael</code> (sem shell)<br><br>Senha para todos: <code>compedel@314</code>" },
        5: { t: "05. Autofs NFS", n: 1, d: "Configure autofs para montar:<br><br><code>serverb.lab.example.com:/rhome/remoteuser18</code><br><br>em <code>/rhome/remoteuser18</code> (grav√°vel)" },
        6: { t: "06. Cron Job", n: 1, d: "Configure cron para usu√°rio <code>john</code>:<br><br>Executar <code>/bin/echo 'hello world'</code> diariamente √†s 12:30" },
        7: { t: "07. Cliente NTP", n: 1, d: "Configure o sistema como cliente NTP de <code>classroom.example.com</code>" },
        8: { t: "08. Busca de Arquivos", n: 1, d: "Localize todos os arquivos pertencentes a <code>emma</code> e copie para <code>/root/find.user</code>" },
        9: { t: "09. Busca de String", n: 1, d: "Encontre todas as ocorr√™ncias de <code>ich</code> em <code>/usr/share/dict/words</code> e salve em <code>/root/lines</code>" },
        10: { t: "10. Usu√°rio com UID", n: 1, d: "Crie usu√°rio <code>alex</code> com UID 2345 e senha <code>Compedel@124</code>" },
        11: { t: "11. Backup Tar", n: 1, d: "Fa√ßa backup de <code>/usr/local</code> como <code>/root/backup.tar.gz</code> (usando gzip)" },
        12: { t: "12. Umask do John", n: 1, d: "Configure para usu√°rio john:<br><br>‚Ä¢ Novos arquivos: permiss√£o <code>-r--------</code><br>‚Ä¢ Novos diret√≥rios: permiss√£o <code>dr-x--------</code>" },
        13: { t: "13. Systemd Timer", n: 1, d: "Crie script <code>/usr/local/bin/log_capture</code> que lista arquivos em /tmp e salva em <code>/root/log_output/system_logs.trc</code>. Crie servi√ßo e timer para executar a cada 1 minuto." },
        
        // Node 2 (14-20)
        14: { t: "14. Reset Senha Root", n: 2, d: "No node2, redefina a senha root para <code>compedel@777</code> via modo rescue (interrup√ß√£o do GRUB)." },
        15: { t: "15. Reposit√≥rios Node2", n: 2, d: "Configure os mesmos reposit√≥rios da quest√£o 2 no node2." },
        16: { t: "16. Parti√ß√£o Swap", n: 2, d: "Adicione parti√ß√£o swap de 756MiB em <code>/dev/sdb</code> e ative na inicializa√ß√£o." },
        17: { t: "17. Redimensionar LV", n: 2, d: "Redimensione o LV <code>VO</code> no VG <code>VG</code> para exatamente 230MiB." },
        18: { t: "18. Flatpak", n: 2, d: "Configure Flatpak para usu√°rio <code>student</code>:<br><br>‚Ä¢ Reposit√≥rio: <code>flatdb</code> de <code>https://flathub.org/repo/flathub.flatpakrepo</code><br>‚Ä¢ Instale o aplicativo <code>codium</code>" },
        19: { t: "19. LVM Avan√ßado", n: 2, d: "Crie LV <code>qa</code> no VG <code>qagroup</code>:<br><br>‚Ä¢ Tamanho: 60 extens√µes de 16MiB cada<br>‚Ä¢ Disco: <code>/dev/sdc</code><br>‚Ä¢ Formato: ext4<br>‚Ä¢ Montagem: <code>/mnt/qa</code> (permanente)" },
        20: { t: "20. Tuned", n: 2, d: "Configure o perfil <code>tuned</code> recomendado para o sistema." }
    };

    // Renderizar lista de tarefas
    const taskList = document.getElementById('task-list');
    Object.keys(tasks).forEach(id => {
        let div = document.createElement('div');
        div.className = `task-item node${tasks[id].n}`;
        div.innerHTML = `${tasks[id].t} <span class="node-badge node${tasks[id].n}-badge">Node ${tasks[id].n}</span>`;
        div.onclick = () => loadTask(id);
        taskList.appendChild(div);
    });

    function loadTask(id) {
        currentTaskId = id;
        const task = tasks[id];
        
        document.getElementById('task-title').innerText = task.t;
        document.getElementById('task-desc').innerHTML = task.d;
        document.getElementById('task-node').innerText = `Node ${task.n}`;
        document.getElementById('task-details').style.display = 'block';
        document.getElementById('btn-verify').style.display = "block";
        document.getElementById('btn-hint').style.display = "block";
        
        let statusDiv = document.getElementById('status');
        statusDiv.style.display = "none";
        
        // Mostrar status anterior se j√° completado
        if (completedTasks.has(parseInt(id))) {
            statusDiv.style.display = "block";
            statusDiv.style.background = "#27ae60";
            statusDiv.innerHTML = "‚úÖ <b>Tarefa j√° conclu√≠da anteriormente!</b>";
        }
    }

    async function getAiHint() {
        const statusDiv = document.getElementById('status');
        statusDiv.style.display = "block";
        statusDiv.style.background = "#34495e";
        statusDiv.innerHTML = "üîç Buscando dica da IA...";

        try {
            const response = await fetch(`http://localhost:5005/hint/${currentTaskId}`);
            const data = await response.json();
            statusDiv.style.background = "#2980b9";
            statusDiv.innerHTML = `<b>üí° Dica:</b><br>${data.hint.replace(/\n/g, '<br>')}`;
        } catch (error) {
            statusDiv.style.background = "#e67e22";
            statusDiv.innerHTML = "‚ö†Ô∏è Servidor de dicas offline. Use as anota√ß√µes do curso.";
        }
    }

    async function verifyTask() {
        const statusDiv = document.getElementById('status');
        statusDiv.style.display = "block";
        statusDiv.style.background = "#34495e";
        statusDiv.innerHTML = "‚è≥ Verificando...";

        try {
            const response = await fetch(`http://localhost:5005/check/${currentTaskId}`);
            const data = await response.json();
            
            if (data.success) {
                statusDiv.style.background = "#27ae60";
                statusDiv.innerHTML = "‚úÖ <b>Correto!</b> Parab√©ns!";
                
                // Marcar como completo
                completedTasks.add(parseInt(currentTaskId));
                localStorage.setItem('completedTasks', JSON.stringify([...completedTasks]));
                updateProgress();
            } else {
                statusDiv.style.background = "#c0392b";
                statusDiv.innerHTML = "‚ùå <b>Incorreto.</b> Verifique sua configura√ß√£o e tente novamente.";
            }
        } catch (error) {
            statusDiv.style.background = "#e67e22";
            statusDiv.innerHTML = "‚ö†Ô∏è Servidor de verifica√ß√£o offline. Execute 'python3 app.py' no terminal.";
        }
    }

    function updateProgress() {
        const progress = (completedTasks.size / 20) * 100;
        document.getElementById('progress-fill').style.width = progress + '%';
        document.getElementById('progress-text').innerText = `${completedTasks.size}/20`;
    }

    // Inicializar progresso
    updateProgress();
</script>

</body>
</html>